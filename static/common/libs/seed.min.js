(async function useIdbKeyVal(){const ResolvePathCache={};const isDev=!!localStorage.isDev;const camelizeRE=/\/|\.|_|-(\w)/g;function $$id(id){return document.getElementById(id)}function $$tags(tagName){return document.getElementsByTagName(tagName)}function last(arr){return arr.length?arr[arr.length-1]:false}function camelCase(str=""){str=String(str).replaceAll("@","");return(str&&str.replace(camelizeRE,function(_,c){return c?c.toUpperCase():""}))}const $idb=(function idb_keyval(){function promisifyRequest(request){return new Promise((resolve,reject)=>{request.oncomplete=request.onsuccess=()=>resolve(request.result);request.onabort=request.onerror=()=>reject(request.error)})}function createStore(dbName,storeName){const request=indexedDB.open(dbName);request.onupgradeneeded=()=>request.result.createObjectStore(storeName);const dbp=promisifyRequest(request);return(txMode,callback)=>dbp.then(db=>callback(db.transaction(storeName,txMode).objectStore(storeName)))}let defaultGetStoreFunc;function defaultGetStore(){if(!defaultGetStoreFunc){defaultGetStoreFunc=createStore("keyval-store","keyval")}return defaultGetStoreFunc}function get(key,customStore=defaultGetStore()){return customStore("readonly",store=>promisifyRequest(store.get(key)))}function set(key,value,customStore=defaultGetStore()){return customStore("readwrite",store=>{store.put(value,key);return promisifyRequest(store.transaction)})}function del(key,customStore=defaultGetStore()){return customStore("readwrite",store=>{store.delete(key);return promisifyRequest(store.transaction)})}function clear(customStore=defaultGetStore()){return customStore("readwrite",store=>{store.clear();return promisifyRequest(store.transaction)})}function eachCursor(store,callback){store.openCursor().onsuccess=function(){if(!this.result)return;callback(this.result);this.result.continue()};return promisifyRequest(store.transaction)}function keys(customStore=defaultGetStore()){return customStore("readonly",store=>{if(store.getAllKeys){return promisifyRequest(store.getAllKeys())}const items=[];return eachCursor(store,cursor=>items.push(cursor.key)).then(()=>items)})}return{get,set,keys,clear,del}})();let LOADING_IMAGE_NAME="x-loading";(function loadBaseInfo(){const srcRootDom=$$id("src-root");const{src}=srcRootDom;const[srcRoot]=src.split("/common/libs/seed");const{appName,appEntryName,appVersion,loadingImg,appPrefix="business_",noNprogress}=srcRootDom.dataset;if(!appName){alert("miss APP_NAME")}window.APP_PREFIX=appPrefix;window.SRC_ROOT_PATH=srcRoot||"";window.APP_NAME=appName||"";window.APP_ENTRY_NAME=appEntryName||"entry";window.APP_NO_NPROGRESS=!!noNprogress;window.APP_VERSION=""||appVersion||"";let I18N_LANGUAGE=localStorage["X-Language"]||$$tags("html")[0].lang||"zh-CN";if(!["zh-CN","en-US"].includes(I18N_LANGUAGE)){console.error(`I18N_LANGUAGE is not valid ${I18N_LANGUAGE}`);I18N_LANGUAGE="zh-CN"}localStorage["X-Language"]=I18N_LANGUAGE;window.I18N_LANGUAGE=I18N_LANGUAGE;LOADING_IMAGE_NAME=$resolvePath($resolveSvgIcon(loadingImg||"x-loading"))})();function execXHR(url){return new Promise((resolve,reject)=>{try{var xhr=new XMLHttpRequest();xhr.onprogress=updateProgress;xhr.onload=transferComplete;xhr.onerror=transferFailed;xhr.onabort=transferCanceled;xhr.open("GET",`${url}?_t=${Date.now()}`);xhr.send();function updateProgress(oEvent){if(oEvent.lengthComputable&&oEvent.total){}else{}}function transferComplete({currentTarget}){if(currentTarget.status===404){reject(404)}else{resolve(currentTarget.responseText)}}function transferFailed(evt){console.log("An error occurred while transferring the file.")}function transferCanceled(evt){console.log("The transfer has been canceled by the user.")}}catch(error){debugger}})}function $val(item,prop,val,options={}){item=item||{};const isVue2=item._isVue;const fnVue$set=item.$set;if(typeof prop!="string"){throw new Error("prop must be a string");}const propArray=prop.split(".");let key="";let nextItem=item;const setVal=()=>{while((key=propArray.shift())){if(propArray.length===0){if(isVue2){fnVue$set(nextItem,key,val)}else{Vue?.set&&Vue?.set(nextItem,key,val);nextItem[key]=val}return}else{const _nextItem=nextItem[key];if(!_nextItem){if(isVue2){fnVue$set(nextItem,key,{})}else{nextItem[key]={}}}nextItem=nextItem[key]}}};const delVal=()=>{while((key=propArray.shift())){if(propArray.length===0){if(isVue2){fnVue$set(nextItem,key,val)}else{if(Array.isArray(nextItem)){nextItem.splice(key,1)}else{delete nextItem[key]}}return}else{const _nextItem=nextItem[key];if(!_nextItem){if(isVue2){fnVue$set(nextItem,key,{})}else{nextItem[key]={}}}nextItem=nextItem[key]}}};const getVal=()=>{while((key=propArray.shift())){const _nextItem=nextItem[key];if(!_nextItem){return nextItem[key]}else{if(propArray.length===0){return _nextItem}else{nextItem=nextItem[key]}}}return nextItem};if(val!==undefined){setVal(isVue2,key,propArray,nextItem,val)}if(val==undefined&&options?.delete){delVal(isVue2,key,propArray,nextItem,val)}else{return getVal(isVue2,key,propArray,nextItem)}return item}function $resolveSvgIcon(cptIconName){if(/^http/.test(cptIconName)){return cptIconName}let url=`/common/assets/svg/${cptIconName}.svg`;if(/^_/.test(cptIconName)){const iconName=String(cptIconName).replace(/^_/,"");url=`@/assets/svg/${iconName}.svg`}return url}function $resolvePath(url){if(/^http/.test(url)){return url}let lodash=window._;let resolvedURL=ResolvePathCache[url];if(resolvedURL){return resolvedURL}resolvedURL=url;try{if(lodash?.THIS_FILE_URL){let parentURL=last(lodash.THIS_FILE_URL);const parentResolvedURL=ResolvePathCache[parentURL];if(parentResolvedURL){parentURL=parentResolvedURL.split("/");if(/^\.\//.test(url)){parentURL[parentURL.length-1]=String(url).replace("./","");url=parentURL.join("/")}if(/^\.\.\//.test(url)){parentURL[parentURL.length-1]=String(url).replace("./","");url=parentURL.join("/")}}}}catch(error){console.error(error)}if(/^@/.test(url)){resolvedURL=String(url).replace(/^@/,`${SRC_ROOT_PATH}/${APP_PREFIX}${APP_NAME}`)}if(/^\/common\//.test(url)){resolvedURL=`${SRC_ROOT_PATH}${url}`}ResolvePathCache[url]=resolvedURL;return resolvedURL}async function $loadText(url){return new Promise(async(resolve,reject)=>{const key=camelCase(url);if($loadText.pendding[key]){$loadText.pendding[key].push({resolve,reject})}else{$loadText.pendding[key]=[{resolve,reject}];try{const _url=$resolvePath(url);const res=await execXHR(_url);$loadText.pendding[key].forEach(({resolve})=>resolve(res))}catch(error){$loadText.pendding[key].forEach(({reject})=>reject(error))}finally{delete $loadText.pendding[key]}}})}$loadText.pendding={};const $loadTextCacheify=async function(url){const key=camelCase(url);let res=await $idb.get(key);if(!res){res=await $loadText(url);await $idb.set(key,res)}return res};const _$loadText=(function(){if(!localStorage.isDev&&APP_VERSION){return $loadTextCacheify}return $loadText})();const _$asyncLoadOrderAppendScrips=async function(FRAMWORK_DEEPS){console.time("框架基本依赖");return new Promise(async resolve=>{const scripts=await Promise.all(FRAMWORK_DEEPS.map(async([url,,callback])=>{const innerHtml=await _$loadText(url);return{url,innerHtml,callback}}));const body=$$tags("body")[0];for(const{url,innerHtml,callback}of scripts){const id=camelCase(url);const $script=document.createElement("script");$script.id=id;$script.innerHTML=innerHtml;body.appendChild($script);if(typeof callback==="function"){callback()}}console.timeEnd("框架基本依赖");resolve()})};var $ensure=(()=>{const logEnsure=()=>null;$ensure=async(fnGetValue,duration=0,gap=64)=>{const fnString=fnGetValue.toString();return new Promise((resolve,reject)=>{let timer;let exeCount=0;const checkValue=async()=>{const value=await fnGetValue();logEnsure(fnString,++exeCount);if(value){clearTimeout(timer);resolve(value)}else{timer=setTimeout(checkValue,gap)}};if(duration){setTimeout(()=>{clearTimeout(timer);logEnsure(fnString,exeCount);reject(new Error("ensure timeout"))},duration)}checkValue()})};return $ensure})();const load_count={};async function $appendScript(url,globalName="",_SCRIPT_USE_SRC=false){try{const id=camelCase(url);if(load_count[id]){if(globalName){await $ensure(()=>window[globalName]);return window[globalName]}}else{load_count[id]=true}let $script=$$id(id);if(!$script){$script=document.createElement("script");$script.id=id;if(_SCRIPT_USE_SRC){await new Promise(resolve=>{$script.src=$resolvePath(url);$script.onload=function(event){console.log("event.currentTarget.id",event.currentTarget.id);resolve(event.currentTarget.id)};const body=$$tags("body")[0];body.appendChild($script)})}else{const innerHtml=await _$loadText(url);$script.innerHTML=innerHtml;const body=$$tags("body")[0];body.appendChild($script)}}if(globalName){return $val(window,globalName)}}catch(error){console.error(error)}}function $resolveCssAssetsPath(styleSourceCode){styleSourceCode=styleSourceCode.replace(/\/common\/(assets|libs|ui-element|ui-tiny)/g,path=>$resolvePath(path));styleSourceCode=styleSourceCode.replace(/\/@\//g,$resolvePath("@/"));return styleSourceCode}async function $appendStyle(url,styleSourceCode="",options={}){const{useLink=false}=options;const id=camelCase(url);if(useLink){try{let $link=$$id(id);if(!$link){$link=document.createElement("link");$link.id=id;$link.rel="stylesheet";const body=$$tags("head")[0];body.appendChild($link)}$link.href=$resolvePath(url)}catch(error){}finally{return id}}const innerHtml=await(async function(){if(!styleSourceCode){styleSourceCode=await _$loadText(url);styleSourceCode=$resolveCssAssetsPath(styleSourceCode)}if(window._CURENT_IS_MOBILE){const pxReg=/([-+]?[0-9]*\.?[0-9]+)px/g;styleSourceCode=styleSourceCode.replace(pxReg,(full,num)=>{return`${num}rem`})}return styleSourceCode})();if(!innerHtml){return id}let $style=$$id(id);if(!$style){$style=document.createElement("style");$style.id=id;const body=$$tags("body")[0];body.appendChild($style)}$style.innerHTML=innerHtml;return id}(async function bootstrap(){(async()=>{const search=new URLSearchParams(location.search);if(search.get("useVconsole")){const VConsole=await $appendScript("/common/libs/vconsole.min.js","VConsole");window._vConsole=new VConsole()}})();await(async()=>{if(APP_VERSION&&APP_VERSION!==(await $idb.get("APP_VERSION"))){await $idb.clear();await $idb.set("APP_VERSION",APP_VERSION);window.APP_VERSION=APP_VERSION}await _$asyncLoadOrderAppendScrips([["/common/libs/jquery/jquery-3.7.0.min.js",null,()=>$("body").addClass("x-app-body")],["/common/libs/lodash.js",null,()=>{_.$$tags=$$tags;_.$$id=$$id;_.$val=$val;_.$ensure=$ensure;_.$appendScript=$appendScript;_.$appendStyle=$appendStyle;_.$resolveCssAssetsPath=$resolveCssAssetsPath;_.$idb=$idb;_.$resolveSvgIcon=$resolveSvgIcon;_.$resolvePath=$resolvePath;_.$loadText=_$loadText;_.$asyncLoadOrderAppendScrips=_$asyncLoadOrderAppendScrips}],["/common/libs/dayjs.js"],["/common/libs/vue.js"],["/common/libs/common.ts"],["/common/libs/common.$.ajax.ts"]]);if(isDev){window.ONLY_USE_IN_DEV_MODEL&&window.ONLY_USE_IN_DEV_MODEL()}Vue.prototype._=_;Vue.prototype.$_app_theme=$("html").attr("data-theme");if(window._CURENT_IS_MOBILE){$("meta[name='viewport'").attr("content","width=device-width, initial-scale=1.0, user-scalable=no");function setRemBase(){const wWidth=$(window).width();const rate=wWidth/375;const unit=(16*rate)/16;$("html").css("font-size",unit+"px")}$(window).on("resize",setRemBase).on("orientationchange",setRemBase);setRemBase()}$appendStyle("xLoadingStyle",`html,body,#app{height:100%;width:100%;}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.spin{animation:spin 2s linear infinite}.x-loading{min-height:48px;position:relative;.x-loading::before{animation:spin 2s linear infinite;pointer-events:none;content:" ";display:block;top:0;bottom:0;right:0;left:0;position:absolute;background:url(${LOADING_IMAGE_NAME})center/32px no-repeat;z-index:9999999999}`)})();await(async function setI18nFunction(){_.$newI18n=async function({lang}){let langOptionsString=await _.$loadText(`@/i18n/${lang}.js`);langOptionsString=langOptionsString.replace("window.i18n.options = ","");const getLangOptionsFn=new Function(`return ${langOptionsString};`);const langOptions=getLangOptionsFn();const i18n=function(key,payload){if(key.length>64){alert(`i18n key:【${key}】长度超过64，过长，建议重命名`)}/!*使用 {变量名} 赋值*!/;_.templateSettings.interpolate=/{([\s\S]+?)}/g;let temp=$val(langOptions,key);if(_.isString(temp)){return _.template(temp)(payload)}else{return key}};i18n.langOptions=langOptions;return i18n};const i18n=await _.$newI18n({lang:I18N_LANGUAGE});window.i18n=i18n;Vue.prototype.i18n=i18n})();!APP_NO_NPROGRESS&&(_.$importVue.Nprogress=await _.$importVue("/common/libs/Nprogress.vue"));const APP=await _.$importVue(`${SRC_ROOT_PATH}/${APP_PREFIX}${APP_NAME}/${APP_ENTRY_NAME}.vue`);if(isDev){window.HMR_APP=APP}})()})();